# Как писать плагины для Shower? 

## Введение
На самом деле все предельно просто. 
Богатое API Шовера ограничивает написание плагинов лишь вашей фантазией. 

Перед написанием своего плагина стоит запомнить несколько моментов:
* Каждый плагин — это отдельный JavaScript класс и модуль, описанный в терминах модульной системы [ymodules]. 
* Плагин при создании всегда получает на вход корневой класс Шовера, а также опции, заданные пользователем при инициализации Шовера.

## Какое API доступно плагину? 

Все поля и методы, описаны в документации docs/Shower.md. 
Из плагина можно «дотянуться» практически до любой точки. 

Итак, для примера давайте напишем плагин, который будет выводить номер текущего слайда. 

```javascript
// У каждого плагина есть один идентификатор — его имя. 
// Поэтому имя плагина всегда должно совпадать с именем модуля.
modules.define('shower-logger', [
    
], function (provide) {
   
   // Создадим класс SlideLog, который будет выводить в консоль 
   // индекс активного слайда при каждом переключении (next, prev, go, etc).
   function SlideLog(shower) {
       // Сохраним ссылку на шовер, чтобы в будущем использовать его API.
       this._shower = shower;
   }
   
   SlideLog.prototype = {
       // Метод вызовется автоматически из shower.Plugin, когда
       // Шовер инстанцирует плагин и будет готов его инициализировать.
       init: function () {
            // Добавляем слушатель на активацию слайда в плеере. 
            // Как только он активируется — будет вызван слушатель _onSlideActivate
            // в контексте плагина.
            this._shower.player.events
                .on('activate', this._onSlideActivate, this);
       },
       
       destroy: function () {
           this._shower.player.events
                .off('activate', this._onSlideActivate, this);
                
            this._shower = null;     
       },
       
       _onSlideActivate: function (event) {
           console.log('slide activate. Index: ' + event.get('index'));
       }
   };
   
   // Чтобы плагин появился в модульной системе, необходимо 
   // вернуть его класс. Подробнее: https://github.com/ymaps/modules
   provide(SlideLog);    
});

// Теперь необходимо добавить плагин в shower. 
modules.require(['shower'], function (shower) {
    // Достаточно добавить в менеджер плагинов только имя плагина, которое,
    // напомню, должно равняться имени модуля, в котором описан плагин. 
    shower.plugins.add('shower-logger'); 
});
```

После добавления плагина в менеджер — он автоматически активируется. Если Шовер в момент добавления плагина будет еще не инициализирован, то менеджер дождется момента инициализации и только после этого активирует плагины.

## Опции

Часто плагину необходимо получить какие-то данные от пользователя, будь то селектор для элемента, или количество секунд на автопереключение. 
Для таких случаев сделана возможность задавать опции для плагинов при инициализации.

Например, модифицируем наш плагин, чтобы он мог принимать от пользователя интервал, по которому нужно очищать консоль.

```javascript
shower.init('.shower', {
    plugins: {
        'shower-logger': {
            clearInterval: 10
        }
    }
}
```

Или напрямую из html

```html
<body class="shower" data-plugins="{'shower-logger': {clearInterval: 10}}">
…
</body>
```

Чтобы использовать эти данные, нужно немного модифицировать наш плагин:

```javascript
// Вторым аргументом будут автоматически прокидываться 
// данные, которые указал пользователь.
function SlideLog(shower, options) {
    options = options || {};
    
    this.options = options;
    this._shower = shower;
}
```
И используем наши опции в методе init.
```javascript
init: function () {
    ……
    window.setInterval(function () {
        console.clear();   
    }, this.options.clearInterval || 10);
}
```

## API плагина. 

После инициализации плагина, он будет доступен в менеджере, и его инстанцию можно будет получить следующим способом:
```javascript
var myPlugin = shower.plugins.get('plugin-name');
myPlugin.makeAnything();
```

[ymodules]:https://github.com/ymaps/modules
